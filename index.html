<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>"Exploring “Chineseness” in AI-generated Music: A Quantitative-Qualitative Study"</title>
    <!-- arquero -->
    <script src="https://cdn.jsdelivr.net/npm/arquero@latest"></script>
    <!-- Plotly.js -->
    <!-- <script src="https://cdn.plot.ly/plotly-3.1.0.min.js" charset="utf-8"></script> -->
    <script charset="utf-8" src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
    <!-- bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <!-- Grid.js (lightweight interactive tables, no jQuery) -->
    <link href="https://unpkg.com/gridjs/dist/theme/mermaid.min.css" rel="stylesheet" />
    <script src="https://unpkg.com/gridjs/dist/gridjs.umd.js"></script>
    <!-- DataFrame-js -->
    <script src="https://unpkg.com/dataframe-js@1.4.5/dist/dataframe.min.js"></script>
    <style>
    </style>
</head>

<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-12 m-2 p-2">
                <div>
                    <h6 class="badge bg-info">v0.10</h6>
                    <p class="display-6">
                        Exploring “Chineseness” in AI-generated Music: A Quantitative-Qualitative Study
                    </p>
                    <!-- <p>by Y.Zhao and L.Casini.</p> -->
                    <p>
                        This page contains interactive versions of the visualizations featured in the paper.<br>
                        Press the buttons to switch between different plots. <br>
                        Click on points in the scatter plots to open the corresponding song in a new tab.
                    </p>
                    <hr>
                    <!-- button for selecting which plot to visualize among: lyrics, tags categories and top 100 tags-->
                    <div class="btn-group" role="group" aria-label="Plot Type">
                        <input type="radio" class="btn-check" name="plotType" id="plotType_lyrics" autocomplete="off"
                            value="lyrics" checked>
                        <label class="btn btn-outline-primary" for="plotType_lyrics">Lyrics</label>

                        <input type="radio" class="btn-check" name="plotType" id="plotType_tags" autocomplete="off"
                            value="tagscat">
                        <label class="btn btn-outline-primary" for="plotType_tags">Tags Categories</label>

                        <input type="radio" class="btn-check" name="plotType" id="plotType_prompt" autocomplete="off"
                            value="tags100">
                        <label class="btn btn-outline-primary" for="plotType_prompt">Top 100 Tags</label>
                        <!-- Button to show cluster contents -->
                        <button id="showClustersBtn" type="button" class="btn btn-outline-secondary"
                            title="Show cluster contents">Cluster Contents</button>
                    </div>
                    <hr>
                </div>
                <div class="col-12">
                    <div id="plotDiv" class="my-3"></div>
                </div>
                <div id="infoDiv" class="col-12 border-1">
                    <h3>Cluster Contents</h3>
                    <!-- Controls: select column to show and hdb_label filter -->
                    <div class="d-flex gap-2 align-items-center my-2">
                        <div>
                            <label for="columnSelect" class="form-label small mb-0">Show column</label>
                            <select id="columnSelect" class="form-select form-select-sm">
                                <option value="__all__">All columns</option>
                            </select>
                        </div>
                        <div>
                            <label for="hdbSelect" class="form-label small mb-0">Filter hdb_label</label>
                            <select id="hdbSelect" class="form-select form-select-sm">
                                <option value="__all__">All hdb_label</option>
                            </select>
                        </div>
                        <div class="flex-grow-1"></div>
                        <div id="tableStatus" class="text-muted small"></div>
                    </div>
                    <!-- Interactive table will be inserted here -->
                    <div id="tableContainer" class="my-2"></div>

                    <!-- Details modal for row JSON -->
                    <div class="modal fade" id="rowDetailModal" tabindex="-1" aria-labelledby="rowDetailModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog modal-lg modal-dialog-scrollable">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="rowDetailModalLabel">Row details</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <pre id="rowDetailPre" style="white-space:pre-wrap;word-break:break-word"></pre>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary"
                                        data-bs-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>


        <script>
            // Use site-relative path so it works on GitHub Pages and local server
            datasetURL = 'data/zh_songs.json'


        </script>

        <script>
            // Only consider plot type, not labels
            let currentPlot = '';

            // Listen for plot type radio button changes
            document.getElementsByName('plotType').forEach(function (plotType) {
                plotType.addEventListener('change', function () {
                    let plotTypeValue = plotType.value;
                    currentPlot = plotTypeValue;
                    createPlot(plotTypeValue);
                });
            });
        </script>

        <script>
            // Use site-relative path so it works on GitHub Pages and local server
            const datasetURL = 'data/zh_songs.json'

            let df = null; // DataFrame-js instance

            // Utility to pretty-print
            function pretty(obj) { try { return JSON.stringify(obj, null, 2); } catch (e) { return String(obj); } }

            // Render HTML table from an array of objects and columns
            function renderHtmlTable(container, rows, cols, maxRows = 500) {
                container.innerHTML = '';
                const table = document.createElement('table');
                table.className = 'table table-sm table-striped table-bordered';
                const thead = document.createElement('thead');
                const tr = document.createElement('tr');
                for (const c of cols) {
                    const th = document.createElement('th'); th.textContent = c; tr.appendChild(th);
                }
                thead.appendChild(tr); table.appendChild(thead);
                const tbody = document.createElement('tbody');
                const limited = rows.slice(0, maxRows);
                for (const r of limited) {
                    const tr = document.createElement('tr');
                    for (const c of cols) {
                        const td = document.createElement('td');
                        let v = r[c];
                        if (v === null || v === undefined) v = '';
                        else if (typeof v === 'object') v = pretty(v);
                        td.textContent = String(v);
                        tr.appendChild(td);
                    }
                    tbody.appendChild(tr);
                }
                table.appendChild(tbody);
                container.appendChild(table);
                if (rows.length > maxRows) {
                    const note = document.createElement('div'); note.className = 'small text-muted';
                    note.textContent = `(showing first ${maxRows} of ${rows.length} rows)`;
                    container.appendChild(note);
                }
            }

            async function loadAndBuild() {
                const status = document.getElementById('tableStatus');
                const container = document.getElementById('tableContainer');
                const columnSelect = document.getElementById('columnSelect');
                const hdbSelect = document.getElementById('hdbSelect');
                status.textContent = 'Loading...';
                try {
                    const res = await fetch(datasetURL);
                    if (!res.ok) throw new Error(`HTTP ${res.status}`);
                    const raw = await res.json();

                    // If root is array, use it. If object, use keys as rows as requested earlier.
                    let rows = null;
                    if (Array.isArray(raw)) rows = raw;
                    else if (raw && typeof raw === 'object') {
                        // rows are top-level keys -> convert to objects
                        rows = Object.keys(raw).map(k => {
                            const v = raw[k];
                            if (v && typeof v === 'object' && !Array.isArray(v)) return Object.assign({ '_key': k }, v);
                            return { '_key': k, 'value': v };
                        });
                    } else {
                        throw new Error('Unexpected JSON structure');
                    }

                    // Create DataFrame
                    df = new DataFrameJs.DataFrame(rows);

                    // Populate column dropdown
                    const cols = df.listColumns();
                    columnSelect.innerHTML = '<option value="__all__">All columns</option>' + cols.map(c => `<option value="${c}">${c}</option>`).join('');

                    // Populate hdb_label dropdown
                    const hdbVals = Array.from(new Set(df.toArray().map(r => r[df.listColumns().indexOf('hdb_label')]))).filter(v => v !== undefined && v !== null).map(String).sort();
                    hdbSelect.innerHTML = '<option value="__all__">All hdb_label</option>' + hdbVals.map(v => `<option value="${v}">${v}</option>`).join('');

                    // Handlers
                    columnSelect.onchange = updateTable;
                    hdbSelect.onchange = updateTable;

                    // Initial render
                    updateTable();

                    function updateTable() {
                        const colChoice = columnSelect.value;
                        const hdbChoice = hdbSelect.value;
                        let filtered = df;
                        if (hdbChoice && hdbChoice !== '__all__' && df.listColumns().includes('hdb_label')) {
                            filtered = filtered.filter(row => String(row.get('hdb_label')) === hdbChoice);
                        }
                        let outCols = filtered.listColumns();
                        if (colChoice && colChoice !== '__all__') outCols = [colChoice];
                        // Get rows as array of objects
                        const rowsOut = filtered.toCollection();
                        // Render
                        renderHtmlTable(container, rowsOut, outCols, 500);
                        status.textContent = `Showing ${rowsOut.length} rows`;
                    }

                } catch (err) {
                    console.error(err);
                    status.textContent = 'Error: ' + err.message;
                }
            }

            // Start once DOM loads
            window.addEventListener('DOMContentLoaded', () => {
                const infoDiv = document.getElementById('infoDiv');
                if (infoDiv) loadAndBuild();
            });
        </script>